<link rel="import" href="/app/libs/polymer/polymer.html">
<link rel="import" href="/app/libs/google-map/google-map.html">
<link rel="import" href="/app/components/incident-item.html">
<link rel="import" href="/app/components/incident-annotation.html">
<link rel="import" href="/app/libs/juicy-html/juicy-html.html">

<polymer-element name="incident-map">
    <template>
        <style>
            google-map {
                height: 600px;
                width: 600px;
            }
        </style>
        <div id="mainPage">
            <table>
                <tr>
                    <td>
                        <google-map latitude="45.5257329" longitude="-73.5607663" fitToMarkers>
                            <template repeat="{{incident, i in incidents}}">
                                <google-map-marker latitude="{{incident.coordinates.lat}}" longitude="{{incident.coordinates.lng}}" icon="/app/images/{{incident.type}}.png" title="{{incident.title}}" click-events="{{true}}" on-google-map-marker-click="{{onGoogleMapMarkerClicked}}">
                                    <a href="{{incident.news_url}}">{{incident.title}}</a>
                                    <!--<annotated src="{{incident.cover_image}}" annotations={{incident.positionalAnnotations}}></annotated>-->
                                    <!--I had to copy and paste the whole freaking component in here, becuase google maps is lame-->
                                    <div style="width: 500px; height: 350px; position: relative; background: url('{{incident.cover_image}}');">
                                        <template repeat="{{annotation in incident.positionalAnnotations}}">
                                            <div class="annotation" style="border: double 3px white; position: absolute; top: {{annotation.top}}px; left: {{annotation.left}}px; width: {{annotation.width}}px; height: {{annotation.height}}px;" on-mouseover="{{onMouseEnter}}" on-mouseout="{{onMouseLeave}}" on-click="{{onMouseEnter}}"></div>
                                        </template>
                                    </div>
                                </google-map-marker>
                            </template>
                        </google-map>
                        <p>
                            Select a timeframe for the map 
                            <form>
                                <input type="date" value="2015-03-15">
                            </form>
                        </p>
                        
                    </td>
                    <td>
                        <div id="breakingNews">
                            <img
                                src="/app/images/breaking-news.jpg"
                                style="width: 100%; height: 75%">
                            <h3>Breaking news for traffic in Montreal Â»</h3>
                            <ul>
                                <template repeat="{{incident in incidents}}">
                                    <incident-item incident={{incident}}></incident-item>
                                </template>
                            </ul>
                        </div>
                        <div id="reportIncident">
                        <h4>Upload your incident</h4>
                        <p>
                            Submit your incidents to the CBC.
                        </p>
                        <p>
                            <table>
                                <tr>
                                    <td>
                                        <img src="/app/images/upload_now.png">
                                     </td>
                                     <td>
                                        You must be a member of the CBC News Community to upload.
                                        <a href="FakeLink.com">Sign Up now</a>.
                                    </td>
                                </tr>
                            </table>
                        </p>
                    </div>
                    <div id="legend">
                        <h3>Legend</h3>
                        <table>
                            <tr>
                                <td>
                                    <h2 id="legendTitle">Traffic</h2>
                                    <p>
                                        Pedestrian
                                    </p>
                                    <p>
                                        Bicycle
                                    </p>
                                    <p>
                                        Vehicular
                                    </p>
                                    <p>
                                        Construction and road closure
                                    </p>
                                </td>
                                <td>
                                    <h2 id="legendTitle">Event</h2>
                                    <p>
                                        <img src="/app/images/fire.png" style="width: 18px; height:
                                        18px">  Emergency (fire, water main break)
                                    </p>
                                    <p>
                                        <img src="/app/images/police.png" style="width: 18px;
                                        height: 18px">  Police operation
                                    </p>
                                    <p>
                                        Protest
                                    </p>
                                    <p>
                                        Other
                                    </p>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
        <link rel="stylesheet" href="/app/css/style.css">
        <link rel="stylesheet" href="/app/libs/jquery-image-annotate/dist/css/annotate.min.css">
    </template>
    <script src="/app/libs/jquery-image-annotate/dist/js/jquery.min.js"></script>
    <script src="/app/libs/jquery-image-annotate/dist/js/jquery-ui.min.js"></script>
    <script src="/app/libs/jquery-image-annotate/dist/js/jquery.annotate.min.js"></script>
    <script>
        Polymer({
            incidents: globals.incidents,
            archive: function() {
            },
            onGoogleMapMarkerClick: function(event) {
                console.log('event: ', event);
            },
            onMouseEnter: function() {
            console.log('on enter');
            },
            onMouseLeave: function() {
            console.log('on leave');
            },
            ready: function() {
                this.incidents.forEach(function(element) {
                    element.positionalAnnotations = element.annotations.filter(function(element) {
                        return element.top;
                    });
                });
                console.log('new incidents: ', this.incidents);
/*
                this.$.mainPage.querySelector('google-map-marker').addEventListener('google-map-marker-click', function() {
                    console.log('asdgfh');
                });
*/
            },
        });
    </script>
</polymer-element>
